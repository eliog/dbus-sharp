CSC=gmcs
NUNIT_CONSOLE=$$(echo $$(which nunit-console2 || which nunit-console))
RUNNER=$(NUNIT_CONSOLE) -nologo

TESTS= \
	AddressTest.cs \
	AuthenticationTest.cs \
	BusTests.cs \
	ExportInterfaceTest.cs \
	MatchRuleTest.cs \
	ObjectPathTest.cs \
	SignatureTest.cs

TESTLIB=dbus-sharp-tests.dll

$(TESTLIB): $(TESTS)
	$(CSC) -debug -t:library -out:$@ -r:dbus-sharp.dll -keyfile:../dbus-sharp.snk -pkg:mono-nunit $(TESTS)

.PHONY: setup run clean
setup:
	ln -sf ../src/dbus-sharp.dll .
	ln -sf ../src/dbus-sharp.dll.config .
	ln -sf ../src/dbus-sharp.dll.mdb .

run: $(TESTLIB)
	$(RUNNER) $(TESTLIB)

clean:
	rm $(TESTLIB)
